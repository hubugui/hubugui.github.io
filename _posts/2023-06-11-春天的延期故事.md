---
layout: post
title: 春天的延期故事                               # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"        # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                     # Add bootstrap to the page
published: true
tags: [项目管理]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

春天，早晨走在学院路边的小道，西侧年轻的大学生走出校门，东侧树荫下几株零零散散的新花，退休老太太开开心心去植物园。而我，赶去解决遗留bug，这些bug虽然寄身于电子世界，但和自然一样，都有前因后果，属于某些规律的投影，所以哪怕看上去陷入泥泞，于我心亦无挂碍。

# 1. 背景

* 现象

一项功能中有3个设备的输入信号，下面简称A、B、C，其中A和B属于同一种设备，错误现象是GUI上回放数据使用倍速、不断跳转时，A和B信号数据的时间戳不同步。

* 目标

计划5个工作日完成，A功能代码大约1500行。

# 2. 过程

## 2.1. 第1阶段

1. 看A功能代码结构，4小时。
2. 看A功能代码中的跳转逻辑，牵扯到不同文件的切换，并做错误现象环境的搭建和复现。7小时。
3. 精度关键代码，排查现象，发现一些奇奇怪怪的不符直觉的代码和存储结果，比如A和B的规格不同，信号数据文件大小不同，导致很容易发生偏差。16小时。
4. 发现及解决异常崩溃，加入检测A和B信号数据不同步时的对齐：强制跳转功能，记录并清理不断跳转时的历史数据，避免因强制跳转导致未能正确跳转到用户期望的位置。16小时。

在计划时间内，解决了稳定性问题，并支持了主动对齐，达到频繁跳转时的可用状态。

## 2.2. 第2阶段

经过测试发现还存在各种问题，其中一部分是由于第1阶段修改促使关联模块出现”排他性“，于是埋头苦干，逐步延申到：

1. A、B、C三者之间在各种情况下的不同步。
2. 死循环、死锁、频繁操作崩溃。
3. 停止、播放结尾、中途切换信号文件时状态错误。
4. 不响应RPC请求。
5. C落后于A。
6. 其他但凡和C有关的功能，都一并有震动。
7. 单人操作尚可，5人并发异常。

最后又投入22个工作日，再加数十个小时的加班，才算告一段落。

# 3. 感受

每天面对代码的失态，小到无符号和有符号的混用、冗余IO操作、几百行的大函数、全局变量漫游、内存泄露，大到二分法死循环、全局变量被多线程覆盖、线程不安全，保持情绪，屏住呼吸、烦而往之。

比代码更难的是进度会议。

## 3.1. 不能明确维护代码过程的步骤，就难以合理估算工时

这个软件你不熟悉，但要解决她的复杂问题，第一个困难是估算工时，但一旦拍脑袋决定是5天，后面的延期会成为负担，引起恐慌，哪怕这是不合理的。只有认识到这种情形下的工作步骤，才有可能减少误差。

在[开源软件的故障处理](https://hubugui.github.io/2022/12/11/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%9A%84%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86.html)中做过一些讨论，可以按照下面步骤来拆解。

* 再现
* 什么是对的
* 定位
* 理解意图
* 设计新方法
* 实现
* 检验

## 3.2. 房间乱了，不整理，每次找东西都会很慢

假设你有1个3米 * 3米的书柜，各种教材、小说、哲学、科幻、专业书籍未做分类，随手扔进去，有一天你要找《红楼梦》花费10分钟翻遍整个柜子，下一次再去找《设计原本》还是会花费10分钟。

对于软件来说，没有设计文档、面条代码，就相当于乱序的书柜，更为严重的是，每几行代码就是一个逻辑决策点，你没有对相关决策点的理解和记忆，每次都要重新阅读，所以代码的可读性对于维护非常关键。

## 3.3. 细节是魔鬼：说来容易做来难



## 3.4. 有些功能是在错误实现基础上，临时可用的，一旦修复1个错误，反而整体变得不可用

## 3.5. 长周期里真正胜出的产品都是因为良好设计，软件也是设计和编写出来的，缺少设计和调试出来的软件往往只能在当前约束下良好运行，软件外部或内部发生变化时容易翻车，且耗费维护成本
