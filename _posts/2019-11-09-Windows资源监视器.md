---
layout: post
title: Windows资源监视器                                # Title of the page
hide_title: false                                  # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"   # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                   # Add bootstrap to the page
tags: [windows, 资源监视器, devops]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

# 1. 打开

* 鼠标：任务栏上右键->启动任务管理器(K)->性能->打开资源监视器
* 命令-Windows 7：`resmon`或`perfmon /res`
* 命令-Windows Server 2012：`resmon`或`perfmon /res`
* 命令-Windows 10：`resmon`或`perfmon`

下面以Windows 10为例，介绍常用功能标签，Windows 7和Windows Server 2012也差不多。

# 2. 概述

![](/assets/img/post/2019-windows_perfmon/introduce.png)

分为4个分类区域：

1. CPU
  * 选中某个进程后，整个软件GUI中都优先显示该进程的资源使用信息，并且此时点击**鼠标右键**提供杀死进程功能。
1. 磁盘
  * 请查看下方**5.2 硬盘活动**。
1. 网络
  * 请查看下方**6.2 网络活动**
1. 内存

在每个显示出分类名称的标题栏上点击**鼠标左键**或**鼠标右键**，会收缩、展开其内容。每个分类区域显示的都是一张多行多列的数据表，在表头上点击**鼠标右键**来选择想要显示的数据，推荐**CPU**分类保持默认，其他分类全选。

每张数据表会根据数据多少，来自动显示或隐藏左右、上下滚动条，在数据表的各个列标题上点击**鼠标左键**，可根据该列的值作为查询条件，升降排序显示数据。鼠标放在某个列标题上后，按住**Ctrl**键还能够左右移动该列到新的位置。

这里汇总了4种资源的统计信息，在其他4个标签页中有更详细的描述，各个标签页中的UI习惯保持一直。

# 3. CPU

略。

# 4. 内存

略。

# 5. 磁盘

命令行运行**chkdsk**时的截图如下：
![](/assets/img/post/2019-windows_perfmon/disk.png)

## 5.1 磁盘活动的进程

每个进程占用一行，假设PID为4的内核进程**system**读写10个文件，这里只有1条记录，合并了带宽：

1. PID。
1. 映像，即进程名，并附带单选框，可选择只看该进程，点击**鼠标右键**提供杀死进程功能。。
1. 读(字节/秒)，最近一分钟的平均值。
1. 写(字节/秒)，最近一分钟的平均值。
1. 总数(字节/秒)，最近一分钟的平均值。

显示每个进程读写每个文件的带宽、优先级、响应时间等信息。

## 5.2 磁盘活动

每个进程读写的每一个文件，分别占用一行，假设PID为4的内核进程**system**读写10个文件，这里有10条记录：

1. PID。
1. 映像，即进程名。
1. 文件。
1. 发送(字节/秒)，最近一分钟的平均值。
1. 接收(字节/秒)，最近一分钟的平均值。
1. 总数(字节/秒)，最近一分钟的平均值。
1. IO优先级。
1. 响应时间(ms)。

**磁盘活动**标题栏的中间和右边，还显示有2个重要的性能指标：

* 绿色正方形的**x 千字节/秒磁盘I/O**。
  * 所有进程的磁盘读 +写的带宽总数据量。
* 蓝色正方形的**x% 最长活动时间**。
  * 磁盘驱动器花在读写文件上的时间消耗百分比。运行**chkdsk**扫描磁盘、使用迅雷下载、视频平台软件多路存储时，都可能会导致该值飙升，严重时达到100%，还会导致上述**响应时间(ms)**升高，比如到3000ms，也就是移动磁头、写入文件延时了3秒钟。

没有多块物理磁盘的测试，估计此时这里会显示平均值。

## 5.3 存储

1. 逻辑磁盘。
1. 物理磁盘。
1. 活动时间(%)。
  * 和上述**最长活动时间**正相关。
1. 可用空间(MB)。
1. 总空间(MB)
1. 磁盘队列长度。
  * 待处理的磁盘请求队列的长度，也和上述**最长活动时间**正相关。

## 5.4 常见问题

### 5.4.1 例子1：电脑反应慢

尤其访问文件系统的软件反应更慢，这可能和硬盘IO太高有关，查看**磁盘活动**中的**最长活动时间**，如果超过70%就可能影响到使用。

此时进入**磁盘活动的进程**，点击**总数(字节/秒)**，降序显示，查看最高占用进程的**映像**，关闭她即可。

但很多时候应用软件写入大数据量到硬盘，是由操作系统内核中**PID**为4的**system**进程来完成物理写入的，你无法杀死她，就需要到**磁盘活动**中通过**文件**来辨别**system**写入的文件应该是由哪些应用软件访问，从而去杀死这些应用软件。

还有一些特殊的文件，比如：

1. 用于虚拟内存映射的`c://pagefile.sys`
  * 如果该文件的**总数(字节/秒)**很高，意味着频繁发生了页面错误的系统中断，也不是好现象，应该去分析任务管理器中最高的**页面错误增量**所在进程。
1. 用于NTFS文件系统的类似Unix上**Super Block**的`c:\\$Bitmap`、`c:\\$Extend`、`c:\\$Logfile(NTFS卷日志)`、`c:\\$Mft(NTFS主文件表)`等。
  * 如果文件碎片多的同时又有大量文件同时读写，这些文件的访问也可能会繁忙。

# 6. 网络

![](/assets/img/post/2019-windows_perfmon/network.jpg)

**有以下4种分类方式显示网络资源占用情况：**

1. **网络活动的进程**
1. **网络活动**
1. **TCP连接**
1. **侦听端口**

## 6.1 网络活动的进程

每个进程占用一行，显示出：

1. PID。
1. 映像，即进程名，并附带单选框，可选择只看该进程，点击**鼠标右键**提供杀死进程功能。。
1. 发送(字节/秒)，最近一分钟的平均值。
1. 接收(字节/秒)，最近一分钟的平均值。
1. 总数(字节/秒)，最近一分钟的平均值。

直观地看到每个进程分别有多少输入、输出的网络流量，不足之处是刷新率太低，且不能看到进程在不同网卡的流量，后者对于分析那些使用多张网卡的软件很有用。

她和下面**网络活动**的最大区别是前者显示每个进程网络信息的总和，后者根据不同地址单独显示，更为详尽。

## 6.2 网络活动

每个进程和对端网络地址分别占用一行，显示出：

1. PID。
1. 映像，即进程名。
1. 地址。
1. 发送(字节/秒)，最近一分钟的平均值。
1. 接收(字节/秒)，最近一分钟的平均值。
1. 总数(字节/秒)，最近一分钟的平均值。

**网络活动**标题栏的中间和右边，还显示有

* 绿色正方形的**x Kbps 网络 I/O**。
  * 所有进程的网络输入 + 输出的带宽总数据量，包括本地协议栈，比如发给`localhost`、不经过网卡的TCP数据。
* 蓝色正方形的**x% 网络使用率**。
  * 所有进程的网络输入 + 输出流量 / 网络总带宽的百分比，不包括本地协议栈。

## 6.3 TCP连接

每个进程的不同TCP连接分别占一行，包含标示TCP的4要素：

1. PID。
1. 映像，即进程名。
1. 本地地址。
1. 本地端口。
1. 远程地址。
1. 远程端口。
1. 发送(字节/秒)，最近一分钟的平均值。
1. 接收(字节/秒)，最近一分钟的平均值。
1. 总数(字节/秒)，最近一分钟的平均值。
1. 数据包丢失(%)，丢失时会导致重传、使得延迟变高，最近一分钟的平均值。
1. 延迟时间(ms)，最近一分钟的平均值。

## 6.4 侦听端口

每个进程侦听的不同端口分别占用一行，显示出：

1. PID。
1. 映像，即进程名。
1. 地址。
1. 端口。
1. 协议，TCP或UDP。
1. 防火墙状态。

## 6.5 常见问题

### 6.5.1 例子1：如何统计某个进程的网络占用情况？

在**网络活动的进程**区域，单击**PID**排序，找到具体进程后打钩，然后在下面**网络活动**和**TCP连接**中，可查看详细和每个网络地址之间数据流量。

### 6.5.2 例子2：如何查看某个进程存在哪些TCP连接？

在**网络活动的进程**区域，单击**PID**排序，找到具体进程后打钩，然后查看**TCP连接**区域。

### 6.5.3 例子3：如何查看本机TCP 80端口被哪个进程占用？

选择**侦听端口**区域，点击**端口**列进行端口号排序，重复点击实现递减排序，再通过**协议**列上选出TCP，可看到对应行左侧的**PID**和**映像**。

# 7. 参考

1. [Windows 7任务管理器](https://hubugui.github.io/2019/11/16/Windows-7%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8.html)
1. [Windows 10和Server 2012任务管理器](https://hubugui.github.io/2019/11/16/Windows-10%E5%92%8CServer-2012%E4%B8%8A%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8.html)
1. [aida64-强大的软硬件系统信息工具](https://www.aida64.com/)
1. [CPU-Z](https://www.cpuid.com/softwares/cpu-z.html)
1. [GPU-Z](https://www.techpowerup.com/)