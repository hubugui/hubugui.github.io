---
layout: post
title: Cuda无效设备                                 # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"        # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                     # Add bootstrap to the page
tags: [nvidia, cuda, ffmpeg]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

# 1. 背景

一个软件支持在1块Nvidia显卡上做视频解码、图像处理和D3D9绘制，去年v1.0版本在项目A的Windows7 + 2块显卡环境下，每个进程对应1个显卡时工作正常。

去年下半年为项目B加入了几个新功能发布v1.1，通过了项目B的Windows 10单显卡环境测试和现场验证。现在给项目A升级后发现有1个进程失败，日志中显示CUDA错误：

{% highlight c linenos %}
CUDA_ERROR_INVALID_DEVICE: invalid device ordinal
{% endhighlight %}

软件框架图如下，FOO通过CUDA Driver分配显存，来协调FFMPEG、BAR做解码和图像处理，然后把最终图像渲染到对应显示器。

![框架](/assets/img/post/2022-08-25-Cuda-invalid/architecture.png "框架")

# 2. 过程

### 第1天，2022/08/19，周五

### 第2天，2022/08/20，周六

### 第3天，2022/08/22，周一

# 3. 答案

# 4. 回顾

# 5. 重新出发

# 6. 根因