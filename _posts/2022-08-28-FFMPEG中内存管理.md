---
layout: post
title: FFMPEG中内存管理                              # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
bootstrap: true                                     # Add bootstrap to the page
tags: [ffmpeg]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

发现想要分析下AVFrame资源管理、引用，需要先弄清楚整个的内存管理机制，参考ffmpeg n4.4.2版本中[ibavutil/mem.c]()实现。

# 1. 基本API

## 1.1. av_max_alloc

设置这一系列申请内存的最大长度，影响到：

* av_malloc
* av_realloc
* av_fast_realloc

{% highlight c linenos %}
static size_t max_alloc_size= INT_MAX;

void av_max_alloc(size_t max){
    max_alloc_size = max;
}
{% endhighlight %}

## 1.2. av_malloc



## 1.3. av_mallocz

## 1.3. av_free

## 1.4. av_freep

# 3. 数组

## 1.6. 分配数组av_malloc_array

相关API:

* av_mallocz_array
* av_realloc_array
* av_reallocp_array

## 1.7. 动态数组的添加：av_dynarray_add

## 4. 快速分配

## 1.8. av_fast_malloc

## 5. av_memcpy_backptr

