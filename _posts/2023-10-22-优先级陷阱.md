---
layout: post
title: 优先级陷阱                               # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"        # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                     # Add bootstrap to the page
published: true
tags: [开发]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

Github上翻到下面代码：

```
#include <stdio.h>

enum Name { 
    Name_None = 0, 
    Name_A = 1, 
    Name_B = 2, 
    Name_C = 3, 
};

void foo()
{
    enum Name name = Name_C;

    if (!name == Name_C)    printf ("1\n");
    else                    printf ("2\n");
}

void bar()
{
    enum Name name = Name_C;

    if (!name == Name_None) printf ("1\n");
    else                    printf ("2\n");
}

void baz()
{
    enum Name name = Name_None;

    if (!name == Name_A)    printf ("1\n");
    else                    printf ("2\n");
}

int main() 
{
    foo();
    bar();
    baz();
    return 0;
}
```

初衷应该是**!=**，由于!的优先级比==高，且表达式中enum类型转为int处理，所以**foo**和**bar**的输出是对的，**baz**的输出是错误的。

恰好最近翻到[C专家编程](https://book.douban.com/subject/2377310/)，2.3.2谈到**有些运算符的优先级是错误的**，这个现象说明开发者胆大、忽视了编译器警告，同时C语言自身也存在诸多陷阱，起码不像Pascal那样要求表达式中加上显示的括号。

我也记不住优先级，对于不会的，由于遭受过毒打，所以还是做个蠢人，像Pascal要求的那样，用括号包起来，安心下班。

说到这，[C专家编程](https://book.douban.com/subject/2377310/)于我有点像[剑桥倚天屠龙史](https://book.douban.com/subject/30287931/)，我看完后去华山八卦论剑，那些书中的人物就是五绝和裘千仞，一代风流。