---
layout: post
title: 春天的延期故事                               # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"        # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                     # Add bootstrap to the page
published: true
tags: [项目管理]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

春天，早晨下车后步行，西侧年轻的学生走入城市，东侧小道下开出新花，老太太赏花去香山，而我赶去修bug，现在淡然了，寄身于电子世界的bug和自然现象一样，缘起缘灭，于我相无挂碍。

# 1. 背景

* 现象

这个bug既存已久，原作者毕业，回放3个设备(简称A、B、C，A和B属于同一类设备)的信号数据时，A和B数据时间戳不同步。A设备的功能代码大约1500行。

* 目标

计划5个工作日完成。

# 2. 过程

## 2.1. 第1阶段

1. 看代码结构，Dot绘图汇总，打印放手边。耗时8小时。
1. 看代码中跳转逻辑，牵扯到不同数据文件的切换，搭建错误现象的依赖环境和复现。耗时7小时。
1. 精读关键代码，比对现象和代码的联系，发现一些奇奇怪怪、不符直觉的代码和现象，比如设备A和B的规格不同，导致文件的长度不同，更易偏差。耗时16小时。
1. 解决一处异常崩溃，加入检测A和B数据不同步及对齐功能，标记并清理频繁跳转时的历史数据。耗时16小时。

计划时间内解决了稳定性问题、支持主动对齐，频繁跳转在开发环境中达到可用状态。

## 2.2. 第2阶段

由于同一个GUI展现了A、B、C三个数据，涌现很多新问题，其中一部分是老版本的遗留，但由于当时A、B无法同步，未全部发现，还有一部分由于第1阶段的修改，促使关联模块出现”排他性“。局部战斗演变为世界大战，挽起袖子开始撸，陆陆续续延申出如下：

1. A、B、C三者之间在各种操作下的不同步。
1. 诸多操作后死循环、死锁、崩溃。
1. 停止、播放结尾、中途切换信号文件时状态错误。
1. 不响应API请求。
1. C落后A。
1. 但凡和C有关的功能，一并异常。
1. 单机操作尚可，并发出异常。

后续再投入22个开发工作日，外加数十小时的加班，以及一位优秀小伙伴持续检验下，才算告一段落。

# 3. 感受

每天面对失态的代码，小到无符号和有符号的混用、全局变量漫游、冗余锁、几百行的大函数，大到冗余IO、内存泄露、二分法死循环、状态混乱、高耦合、全局变量被多线程覆盖、线程不安全。

这时候主要矛盾已经从做什么和怎么做，变成如何不受广泛关注后进度会议中焦虑弥漫的干扰，持续做正确的事，这一点出乎意料了，也说明开发心理学的重要性。

# 4. 分享

## 4.1. 不能明确维护代码过程的步骤，就无法合理估算

如果你不熟悉这个急待修复的软件，第一个困难是估算进度，因为偏差后的延期成为集体负担，甚至恐慌，成为一段不如意的经历，反而阻碍过程。

在[《开源软件的故障处理》](https://hubugui.github.io/2022/12/11/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%9A%84%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86.html)中做过一些讨论，维护既有软件和开源软件一样，最大的障碍是不熟悉以及尚未解决的问题通常有其难处。过程可分为7个步骤：

![开源软件的故障处理](/assets/img/post/2023-06-18/maintenance.png)

建议把任务分为2段分别估算，第1部分是完成上图中再现、什么是对、定位、理解意图，对问题大致有了认识，再去估算后面几步才能落地，可惜往往还会有明显的误差，因为不动手做，始终缺少细节的考量，保守点做好2倍工时的准备，并不难堪，因为你竟然有勇气直面真相，如实评估后团队才能做出真实计划、调整资源，掌控后续的战斗进程。

**推广开来，越是不明朗的事务，越要落实方法和步骤。**

## 4.2. 细节是魔鬼：说来容易做来难

PPT开发和口头开发，都是面向人类的语言理解系统，突出容易理解的共识概念，开发软件要在计算机中使用编程语言构建、组装一棵棵逻辑树，同时兼顾计算机环境和用户的边界约束，多如牛毛的逻辑决策实现软件六性，优秀和良好、良好和普通的迥异千差万别。

维护软件意味着你要评估前人代码中逻辑树的意图、完成度和不足，做扩充、裁减、嫁接、重写，还要不影响其他子树，当代码高耦合、难读时，非常考验耐心、手艺和心力。

好比给一辆高速前进的汽车更换刹车片，说起来只有一句话：“在没有踩下刹车的时候更换刹车片”，你觉得做起来有哪些困难呢？

## 4.3. 书柜乱了，每次找东西都很慢

你有个大书柜，每次购书随手塞进去，有一天找《三大师谈〈红楼梦〉》花费10分钟，下次找《设计原本》还是10分钟，因为缺少索引。

软件也同样，好的代码自身就是文档，不及格的代码加上缺乏有效文档、注释，就是更为混乱的书柜，代码中每个分支、循环和赋值语句、异步处理、约束条件，都是逻辑决策，不论什么原因，如果你对这些决策没有形成基于线、面和网的洞察，每次分析都要无聊地重读代码。这就是为什么代码可读性、设计围挡是维护成本的关隘。

## 4.4. 基于bug的功能，负负得正

跳转功能没有清理过期数据是一个bug，但却保障各项数据存在某种程度的一致性，当我短暂享受正确清理的喜悦，一杯茶的功夫后发现数据一致性崩塌了。

![负负得正](/assets/img/post/2023-06-18/bugisfeature.jpg)

功能竟然在若干bug的合力下实现了，但只在部分情况下，和下图心意相通。当我短暂享受修复一个bug的喜悦时，发现功能失效了。

## 4.5. 长周期里真正胜出的产品都是因为良好设计，软件也是设计和编写出来的，缺少设计和调试出来的软件往往只能在当前约束下良好运行，软件外部或内部发生变化时容易翻车，且耗费维护成本
