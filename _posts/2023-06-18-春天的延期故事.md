---
layout: post
title: 春天的延期故事                               # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"        # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                     # Add bootstrap to the page
published: true
tags: [项目管理]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

春天，早晨下车后步行8分钟，西侧年轻的学生走入城市，东侧树荫下开出几株新花，老太太开开心心上香山，而我，赶去逮bug，这些寄身于电子世界的bug和自然现象一样，皆有缘起前因，缘灭后果，哪怕一路坎坷，亦无挂碍。

# 1. 背景

* 现象

这是一项既有功能，回放3个设备(简称A、B、C，A和B属于同种类型)的信号数据时发现A和B的数据时间戳不同步。A设备的功能代码大约1500行。

* 目标

计划5个工作日完成。

# 2. 过程

## 2.1. 第1阶段

1. 看代码结构，Dot绘图汇总，打印放手边。耗时8小时。
2. 看代码中跳转逻辑，牵扯到不同数据文件的切换，做错误现象依赖环境的搭建和复现。耗时7小时。
3. 精读关键代码，比对现象和代码的联系，发现一些奇奇怪怪、不符直觉的代码和现象，比如设备A和B的规格不同，导致文件的长度不同，更易偏差。耗时16小时。
4. 发现及解决异常崩溃，加入检测A和B数据不同步及对齐功能，标记并清理频繁跳转时的历史数据。耗时16小时。

计划时间内解决了稳定性问题、支持主动对齐，频繁跳转达到可用状态。

## 2.2. 第2阶段

由于A、B、C三个数据展现在同一个GUI，操作后发现很多新问题，其中一部分是老版本的遗留，但由于之前A和B无法同步，未全部检验出来，还有一部分由于第1阶段修改A、B同步，促使关联模块出现”排他性“。于是挽起袖子开始撸，陆陆续续延申到：

1. A、B、C三者之间在各种操作下的不同步。
2. 诸多操作后死循环、死锁、崩溃。
3. 停止、播放结尾、中途切换信号文件时状态错误。
4. 不响应API请求。
5. C落后A。
6. 其他但凡和C有关的功能，一并出现异常。
7. 单人操作尚可，5人并发异常。

最后再投入22个开发工作日，外加数十小时的加班，以及一位小伙伴持续的协助测试，才算告一段落。

# 3. 感受

每天面对失态的代码，小到无符号和有符号的混用、全局变量漫游、明显错误、几百行的大函数，大到冗余IO、内存泄露、二分法死循环、状态混乱、全局变量被多线程覆盖、线程不安全。

这时候最主要的矛盾不是做什么和怎么做，如何让自己不受广泛关注后进度会议中焦虑情绪的干扰，持续做正确的事，这一点估计是出乎意料的。

# 4. 分享

## 4.1. 不能明确维护代码过程的步骤，就难以合理估算工时

如果你不熟悉软件的功能和代码，却想要解决问题，第一个困难是估算工时，因为一旦做出计划，后面的延期成为集体负担，甚至引起恐慌，最后无论什么结果，都是一段不如意的经历，而且给开发进程带领明显的阻力，哪怕这些结果的起因是不合理的。所以只有明确具体的工作步骤，逐个估算，才有可能接近实际。

在[《开源软件的故障处理》](https://hubugui.github.io/2022/12/11/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%9A%84%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86.html)中做过一些讨论，对于接手维护软件和参与开源软件一样，因为你不熟悉，所以会有以下环节。

![开源软件的故障处理](/assets/img/post/2023-06-18/maintenance.png)

## 4.2. 书柜乱了，每次找东西都很慢

假设你有1个大书柜，每次买书随手扔进去、未作分类，有天你要找《XXX谈红楼梦》花费10分钟，下次找《设计原本》还是10分钟，长期来看趋于平均值，因为书柜缺少索引。

对于软件来说，没有有效的文档、注释和一大坨的面条代码，就是混乱的书柜，更为严重的，每个分支、循环和赋值语句，就是一个逻辑决策，如果你没有对这些决策形成基于面和网的记忆、理解，每次找问题都需要重读代码。这就是为什么代码可读性对于维护非常关键。

## 4.3. 细节是魔鬼：说来容易做来难

PPT开发和口头开发面向人类的语言理解系统，突出共识，压缩比高得离奇，落实到开发工作中来，是要在计算机系统中使用编程语言构建一棵棵逻辑森林，再组装起来，实现软件六性，同时兼顾各种环境和用户要求中的边界例外。

举个例子，人人都知道婴儿啼哭可能是饿了

## 4.4. 有些功能是在错误实现基础上，临时可用的，一旦修复1个错误，反而整体变得不可用

## 4.5. 长周期里真正胜出的产品都是因为良好设计，软件也是设计和编写出来的，缺少设计和调试出来的软件往往只能在当前约束下良好运行，软件外部或内部发生变化时容易翻车，且耗费维护成本
