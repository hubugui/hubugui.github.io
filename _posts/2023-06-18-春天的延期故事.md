---
layout: post
title: 春天的延期故事                               # Title of the page
hide_title: false                                   # Hide the title when displaying the post, but shown in lists of posts
# feature-img: "assets/img/sample.png"              # Add a feature-image to the post
# thumbnail: "assets/img/stb_background.png"        # Add a thumbnail image on blog view
# color: rgb(80,140,22)                             # Add the specified color as feature image, and change link colors in post
bootstrap: true                                     # Add bootstrap to the page
published: true
tags: [项目管理]
excerpt_separator: <!--more-->
---

<!--more-->
* TOC
{:toc}

春天，早晨下车后步行8分钟，西侧年轻的学生走入城市，东侧树荫下开出几株新花，老太太开开心心上香山，而我，赶去逮bug，这些寄身于电子世界的bug和自然现象一样，皆有缘起前因，缘灭后果，哪怕一路坎坷，亦无挂碍。

# 1. 背景

* 现象

这是一项既有功能，回放3个设备(简称A、B、C，A和B属于同种类型)的信号数据时发现A和B的数据时间戳不同步。A设备的功能代码大约1500行。

* 目标

计划5个工作日完成。

# 2. 过程

## 2.1. 第1阶段

1. 看代码结构，Dot绘图汇总，打印放手边。耗时8小时。
1. 看代码中跳转逻辑，牵扯到不同数据文件的切换，做错误现象依赖环境的搭建和复现。耗时7小时。
1. 精读关键代码，比对现象和代码的联系，发现一些奇奇怪怪、不符直觉的代码和现象，比如设备A和B的规格不同，导致文件的长度不同，更易偏差。耗时16小时。
1. 发现及解决异常崩溃，加入检测A和B数据不同步及对齐功能，标记并清理频繁跳转时的历史数据。耗时16小时。

计划时间内解决了稳定性问题、支持主动对齐，频繁跳转达到可用状态。

## 2.2. 第2阶段

由于A、B、C三个数据展现在同一个GUI，操作后发现很多新问题，其中一部分是老版本的遗留，但由于之前A和B无法同步，未全部检验出来，还有一部分由于第1阶段修改A、B同步，促使关联模块出现”排他性“。于是挽起袖子开始撸，陆陆续续延申到：

1. A、B、C三者之间在各种操作下的不同步。
1. 诸多操作后死循环、死锁、崩溃。
1. 停止、播放结尾、中途切换信号文件时状态错误。
1. 不响应API请求。
1. C落后A。
1. 其他但凡和C有关的功能，一并出现异常。
1. 单人操作尚可，5人并发异常。

最后再投入22个开发工作日，外加数十小时的加班，以及一位小伙伴持续的协助测试，才算告一段落。

# 3. 感受

每天面对失态的代码，小到无符号和有符号的混用、全局变量漫游、明显错误、几百行的大函数，大到冗余IO、内存泄露、二分法死循环、状态混乱、全局变量被多线程覆盖、线程不安全。

这时候最主要的矛盾不是做什么和怎么做，如何让自己不受广泛关注后进度会议中焦虑情绪的干扰，持续做正确的事，这一点估计是出乎意料的。

# 4. 分享

## 4.1. 不能明确维护代码过程的步骤，就难以合理估算工时

如果你不熟悉软件的功能和代码，又必须解决问题，第一个困难是估算进度，一旦偏差，后面的延期成为负担，甚至引起恐慌，无论成败，都是一段不如意的经历，即便许多事由的起因并不合理。推广开来，越是不明朗的事务，越待落实方法和步骤，逐个拆解，才可能接近真实。

在[《开源软件的故障处理》](https://hubugui.github.io/2022/12/11/%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%9A%84%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86.html)中做过一些讨论，维护既有软件和参与开源软件一样，最大的障碍在于你不熟悉，以及尚未解决的问题通常有其难处，所以有以下环节。

![开源软件的故障处理](/assets/img/post/2023-06-18/maintenance.png)

## 4.2. 书柜乱了，每次找东西都很慢

你有个大书柜，每次来书随手塞进去、未作分类，有一天你要找《三大师谈〈红楼梦〉》花费10分钟，下次找《设计原本》大概率还是10分钟，因为缺少索引。

对于软件来说也同样，缺乏有效文档、注释和满屏的面条代码，就是更为混乱的书柜，每个分支、循环和赋值语句，都是逻辑决策，如果你对这些决策没有形成基于线、面和网的理解，每次找问题都需要重读代码。这就是为什么文档和代码可读性是维护成本的关隘。

## 4.3. 细节是魔鬼：说来容易做来难

PPT开发和口头开发，都是面向人类的语言理解系统，突出共识概念，高度压缩，实际开发工作是在计算机系统中使用编程语言构建、组装一棵棵逻辑树，同时兼顾计算机环境和用户的边界约束，多如牛毛的逻辑决策实现软件六性，优秀和良好、良好和普通的迥异千差万别。

更为困难的是维护软件，你要理解前人留下逻辑树的意图，做裁减、嫁接、废弃重写，还要不影响其他，好比给一辆高速前进的汽车更换刹车片，可以一句话描述：“在不需要刹车的时候更换刹车片，就可以了”。

## 4.4. 有些功能是在错误实现基础上，临时可用的，一旦修复1个错误，反而整体变得不可用

## 4.5. 长周期里真正胜出的产品都是因为良好设计，软件也是设计和编写出来的，缺少设计和调试出来的软件往往只能在当前约束下良好运行，软件外部或内部发生变化时容易翻车，且耗费维护成本
